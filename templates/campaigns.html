{% extends "base.html" %}

{% block title %}Analytics - WeAD Platform{% endblock %}

{% block extra_head %}
<link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
<style>
    /* Advertiser Section - Dark Red Theme Override */
    :root {
        --quantum-primary: #8B0000 !important;
        --primary: #8B0000 !important;
        --secondary: #5c0000 !important;
        --glow-primary: #8B0000 !important;
        --glow-secondary: #5c0000 !important;
    }
    
    /* Override h1 - White titles */
    h1 {
        background: none !important;
        color: white !important;
        -webkit-text-fill-color: white !important;
        text-shadow: 0 0 20px rgba(139, 0, 0, 0.5) !important;
    }
    
    /* Override h2 - White subtitles */
    h2 {
        color: white !important;
    }
    
    /* Override h3 - White section headers */
    h3 {
        color: white !important;
    }
    
    /* Override button primary styles */
    .btn-primary {
        background: linear-gradient(135deg, #8B0000, #5c0000) !important;
        border-color: #8B0000 !important;
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #5c0000, #3d0000) !important;
        box-shadow: 0 5px 15px rgba(139, 0, 0, 0.4) !important;
    }
    
    /* Override nav-link styles for advertiser section */
    .nav-link:hover,
    .nav-link.active {
        color: #DC143C !important;
        border: 2px solid rgba(220, 20, 60, 0.5) !important;
        box-shadow: 0 4px 15px rgba(220, 20, 60, 0.3) !important;
    }
    
    .nav-link.active {
        border: 2px solid rgba(220, 20, 60, 0.8) !important;
        box-shadow: 0 0 20px rgba(220, 20, 60, 0.5), 0 0 40px rgba(220, 20, 60, 0.3) !important;
    }
    
    /* Override stat-icon background to lighter red */
    .stat-icon {
        background: linear-gradient(135deg, #DC143C, #B22222) !important;
    }
    
    /* Campaign Cards Styling */
    .campaigns-list {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }
    
    .campaign-card {
        background: var(--glass-bg);
        border: 2px solid rgba(139, 0, 0, 0.3);
        border-radius: 16px;
        padding: 1.5rem;
        transition: all 0.3s ease;
    }
    
    .campaign-card:hover {
        border-color: #8B0000;
        box-shadow: 0 10px 40px rgba(139, 0, 0, 0.4);
        transform: translateY(-2px);
    }
    
    .campaign-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid rgba(139, 0, 0, 0.2);
    }
    
    .campaign-header h3 {
        margin: 0;
        font-size: 1.5rem;
        color: white;
        font-weight: 600;
    }
    
    .campaign-status {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: capitalize;
    }
    
    .campaign-status.status-active {
        background: rgba(16, 185, 129, 0.2);
        color: #34d399;
    }
    
    .campaign-status.status-paused {
        background: rgba(251, 191, 36, 0.2);
        color: #fcd34d;
    }
    
    .campaign-status.status-completed {
        background: rgba(148, 163, 184, 0.2);
        color: #cbd5e1;
    }
    
    .campaign-content {
        margin-bottom: 1.5rem;
    }
    
    .campaign-content p {
        color: var(--text-secondary);
        margin-bottom: 1rem;
        line-height: 1.6;
    }
    
    .campaign-stats {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
        margin-top: 1rem;
        padding: 1rem;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 12px;
        border: 1px solid rgba(139, 0, 0, 0.2);
    }
    
    .campaign-stats .stat {
        display: flex;
        flex-direction: row;
        align-items: center;
        gap: 0.5rem;
    }
    
    .campaign-stats .stat .label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        white-space: nowrap;
    }
    
    .campaign-stats .stat .value {
        color: #8B0000;
        font-size: 1.2rem;
        font-weight: 700;
    }
    
    @media (max-width: 768px) {
        .campaign-stats {
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }
    }
    
    .campaign-actions {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
    }
    
    .btn-sm {
        padding: 0.5rem 1rem;
        font-size: 0.9rem;
    }
    
    .btn-danger {
        background: linear-gradient(135deg, #dc2626, #ef4444);
        border: none;
        color: white;
    }
    
    .btn-danger:hover {
        background: linear-gradient(135deg, #b91c1c, #dc2626);
        transform: translateY(-2px);
    }
    
    /* Empty state */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
    }
    
    .empty-state i {
        font-size: 4rem;
        color: #8B0000;
        margin-bottom: 1rem;
    }
    
    .empty-state h3 {
        color: white;
        margin-bottom: 0.5rem;
    }
    
    .empty-state p {
        color: var(--text-secondary);
        margin-bottom: 2rem;
    }
    
    /* Action bar */
    .action-bar {
        display: flex;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
    }
    
    /* Card actions */
    .card-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
    }
    
    .card-actions select {
        background: var(--glass-bg);
        border: 2px solid rgba(139, 0, 0, 0.3);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
    }
    
    .card-actions select:focus {
        outline: none;
        border-color: #8B0000;
    }
    
    /* Large Modal for Campaign Details */
    .modal-large {
        max-width: 1200px;
        width: 95%;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    /* Smaller stat cards in modal */
    #campaign-details-modal .stats-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
    }
    
    #campaign-details-modal .stat-card {
        padding: 1rem;
        transform: scale(0.9);
    }
    
    #campaign-details-modal .stat-icon {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
    }
    
    #campaign-details-modal .stat-content h3 {
        font-size: 1.5rem;
    }
    
    #campaign-details-modal .stat-content p {
        font-size: 0.85rem;
    }
    
    @media (max-width: 768px) {
        #campaign-details-modal .stats-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    /* Live Indicator */
    .live-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #10b981;
        font-weight: 600;
        font-size: 0.9rem;
    }
    
    .pulse {
        width: 8px;
        height: 8px;
        background: #10b981;
        border-radius: 50%;
        animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
        0%, 100% {
            opacity: 1;
            transform: scale(1);
        }
        50% {
            opacity: 0.5;
            transform: scale(1.2);
        }
    }
    
    /* Activity Feed */
    .activity-feed {
        max-height: 300px;
        overflow-y: auto;
    }
    
    .activity-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem;
        border-bottom: 1px solid rgba(139, 0, 0, 0.1);
        transition: background 0.3s ease;
    }
    
    .activity-item:hover {
        background: rgba(139, 0, 0, 0.05);
    }
    
    .activity-item i {
        color: #8B0000;
        font-size: 1.2rem;
    }
    
    .activity-item span:nth-child(2) {
        flex: 1;
        color: white;
    }
    
    .activity-time {
        color: var(--text-secondary);
        font-size: 0.85rem;
    }
    
    /* Campaign Info Grid */
    .campaign-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }
    
    .info-item {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .info-label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        font-weight: 600;
    }
    
    .info-item span:last-child {
        color: white;
        font-size: 1rem;
    }
    
    /* Charts Container */
    .charts-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    
    .charts-container canvas {
        max-height: 300px;
    }
    
    /* Mobile Optimization */
    @media (max-width: 768px) {
        .page-header {
            padding: 1.5rem 1rem !important;
        }
        
        .page-header h1 {
            font-size: 1.8rem !important;
        }
        
        /* Make campaign stats horizontal scroll */
        .campaign-stats {
            display: flex !important;
            overflow-x: auto !important;
            scroll-snap-type: x mandatory !important;
            -webkit-overflow-scrolling: touch !important;
            gap: 1rem !important;
            padding: 0 0.5rem !important;
            scrollbar-width: none !important;
        }
        
        .campaign-stats::-webkit-scrollbar {
            display: none !important;
        }
        
        .campaign-stats .stat {
            flex: 0 0 45% !important;
            scroll-snap-align: center !important;
            min-width: 150px !important;
        }
        
        /* Simplify campaign cards */
        .campaign-card {
            padding: 1rem !important;
        }
        
        .campaign-header {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 0.75rem !important;
        }
        
        /* Stack form elements */
        form .glass {
            padding: 1.5rem 1rem !important;
        }
        
        input, textarea, select {
            font-size: 16px !important; /* Prevents zoom on iOS */
        }
        
        /* Optimize buttons */
        .btn {
            width: 100% !important;
            padding: 0.875rem 1.5rem !important;
        }
        
        /* Make charts responsive */
        .charts-container canvas {
            max-height: 250px !important;
        }
        
        /* Reduce section padding */
        .glass {
            padding: 1.5rem 1rem !important;
        }
        
        /* Stack info items */
        .info-item {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 0.25rem !important;
        }
    }
</style>
{% endblock %}

{% block nav_links %}
<a href="/" class="nav-link">
    <i class="fas fa-home"></i>
    <span>Home</span>
</a>
<a href="/analytics" class="nav-link">
    <i class="fas fa-graduation-cap"></i>
    <span>Intro</span>
</a>
<a href="/advertisers" class="nav-link">
    <i class="fas fa-bullhorn"></i>
    <span>Campaigns</span>
</a>
<a href="/campaigns" class="nav-link active">
    <i class="fas fa-chart-line"></i>
    <span>Analytics</span>
</a>
<a href="/devices" class="nav-link">
    <i class="fas fa-tv"></i>
    <span>Static Displays</span>
</a>
{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <h1><i class="fas fa-chart-line"></i> Campaign Analytics</h1>
        <p>Monitor and analyze all your advertising campaigns in one place</p>
        
        <!-- Demo Disclaimer -->
        <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05)); border: 2px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 1rem 1.5rem; margin-top: 1.5rem; text-align: center;">
            <i class="fas fa-info-circle" style="color: #3b82f6; margin-right: 0.5rem;"></i>
            <span style="color: #93c5fd; font-size: 0.95rem; font-weight: 500;">
                Demo Preview: Campaign data and performance metrics shown are simulated examples. Live campaign analytics will be available once you create and launch actual campaigns.
            </span>
        </div>
    </div>
    
    <!-- Info Banner -->
    <div style="background: rgba(139, 0, 0, 0.1); border: 2px solid rgba(139, 0, 0, 0.3); border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <i class="fas fa-info-circle" style="color: #8B0000; font-size: 1.5rem;"></i>
            <div>
                <h3 style="color: #8B0000; margin-bottom: 0.5rem; font-size: 1.1rem;">Your Campaign Performance Hub</h3>
                <p style="color: var(--text-secondary); margin: 0; line-height: 1.8; font-family: 'Merriweather', Georgia, serif; font-weight: 400; font-size: 1.05rem;">
                    View comprehensive analytics, real-time performance data, and detailed insights for all your launched campaigns. Track views, impressions, reach, spending, and ROI across your entire advertising portfolio.
                </p>
            </div>
        </div>
    </div>

    <!-- Campaign Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-play-circle"></i>
            </div>
            <div class="stat-content">
                <h3 id="active-campaigns">0</h3>
                <p>Active Campaigns</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-eye"></i>
            </div>
            <div class="stat-content">
                <h3 id="total-views">0</h3>
                <p>Total Views</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="stat-content">
                <h3 id="total-spent">$0</h3>
                <p>Total Spent</p>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-content">
                <h3 id="avg-reach">0</h3>
                <p>Avg Reach</p>
            </div>
        </div>
    </div>

    <!-- Analytics Dashboard -->
    <div class="content-card" style="margin-bottom: 2rem;">
        <div class="card-header">
            <h2><i class="fas fa-chart-bar"></i> Campaign Analytics</h2>
        </div>
        <div class="card-content">
            <!-- Charts Grid -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
                <!-- Performance Over Time Chart -->
                <div>
                    <h3 style="color: #8B0000; margin-bottom: 1rem; font-size: 1.1rem;">Performance Over Time</h3>
                    <canvas id="performance-chart" style="max-height: 300px;"></canvas>
                </div>
                
                <!-- Campaign Distribution Chart -->
                <div>
                    <h3 style="color: #8B0000; margin-bottom: 1rem; font-size: 1.1rem;">Campaign Status Distribution</h3>
                    <canvas id="distribution-chart" style="max-height: 300px;"></canvas>
                </div>
            </div>
            
            <!-- Performance Table -->
            <div style="margin-top: 2rem;">
                <h3 style="color: #8B0000; margin-bottom: 1rem; font-size: 1.1rem;">Campaign Performance Breakdown</h3>
                <div style="overflow-x: auto;">
                    <table class="analytics-table" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: rgba(139, 0, 0, 0.1); border-bottom: 2px solid rgba(139, 0, 0, 0.3);">
                                <th style="padding: 1rem; text-align: left; color: #8B0000;">Campaign</th>
                                <th style="padding: 1rem; text-align: center; color: #8B0000;">Views</th>
                                <th style="padding: 1rem; text-align: center; color: #8B0000;">Impressions</th>
                                <th style="padding: 1rem; text-align: center; color: #8B0000;">Reach</th>
                                <th style="padding: 1rem; text-align: center; color: #8B0000;">Budget</th>
                                <th style="padding: 1rem; text-align: center; color: #8B0000;">Spent</th>
                                <th style="padding: 1rem; text-align: center; color: #8B0000;">ROI</th>
                                <th style="padding: 1rem; text-align: center; color: #8B0000;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="analytics-table-body" style="color: #cbd5e1;">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Performing Campaigns -->
    <div class="content-card" style="margin-bottom: 2rem;">
        <div class="card-header">
            <h2><i class="fas fa-trophy"></i> Top Performing Campaigns</h2>
        </div>
        <div class="card-content">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <!-- Top Campaign 1 -->
                <div style="background: linear-gradient(135deg, rgba(139, 0, 0, 0.1), rgba(220, 20, 60, 0.05)); border: 2px solid rgba(139, 0, 0, 0.3); border-radius: 15px; padding: 1.5rem; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 10px; right: 10px; background: linear-gradient(135deg, #8B0000, #5c0000); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 700;">
                        #1 BEST
                    </div>
                    <h3 style="color: #8B0000; margin-bottom: 1rem; font-size: 1.2rem; font-family: 'Merriweather', Georgia, serif;">Summer Sale Campaign</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">Views</div>
                            <div style="color: white; font-size: 1.5rem; font-weight: 700;">45.2K</div>
                        </div>
                        <div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">ROI</div>
                            <div style="color: #10b981; font-size: 1.5rem; font-weight: 700;">+285%</div>
                        </div>
                    </div>
                    <div style="width: 100%; height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden;">
                        <div style="width: 92%; height: 100%; background: linear-gradient(90deg, #8B0000, #5c0000);"></div>
                    </div>
                    <div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.5rem;">92% of budget used</div>
                </div>

                <!-- Top Campaign 2 -->
                <div style="background: linear-gradient(135deg, rgba(139, 0, 0, 0.08), rgba(220, 20, 60, 0.04)); border: 2px solid rgba(139, 0, 0, 0.25); border-radius: 15px; padding: 1.5rem; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 10px; right: 10px; background: rgba(139, 0, 0, 0.5); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 700;">
                        #2
                    </div>
                    <h3 style="color: #8B0000; margin-bottom: 1rem; font-size: 1.2rem; font-family: 'Merriweather', Georgia, serif;">Product Launch</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">Views</div>
                            <div style="color: white; font-size: 1.5rem; font-weight: 700;">38.7K</div>
                        </div>
                        <div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">ROI</div>
                            <div style="color: #10b981; font-size: 1.5rem; font-weight: 700;">+245%</div>
                        </div>
                    </div>
                    <div style="width: 100%; height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden;">
                        <div style="width: 78%; height: 100%; background: linear-gradient(90deg, #8B0000, #5c0000);"></div>
                    </div>
                    <div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.5rem;">78% of budget used</div>
                </div>

                <!-- Top Campaign 3 -->
                <div style="background: linear-gradient(135deg, rgba(139, 0, 0, 0.06), rgba(220, 20, 60, 0.03)); border: 2px solid rgba(139, 0, 0, 0.2); border-radius: 15px; padding: 1.5rem; position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 10px; right: 10px; background: rgba(139, 0, 0, 0.4); color: white; padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.75rem; font-weight: 700;">
                        #3
                    </div>
                    <h3 style="color: #8B0000; margin-bottom: 1rem; font-size: 1.2rem; font-family: 'Merriweather', Georgia, serif;">Brand Awareness</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">Views</div>
                            <div style="color: white; font-size: 1.5rem; font-weight: 700;">32.1K</div>
                        </div>
                        <div>
                            <div style="color: var(--text-secondary); font-size: 0.85rem;">ROI</div>
                            <div style="color: #10b981; font-size: 1.5rem; font-weight: 700;">+198%</div>
                        </div>
                    </div>
                    <div style="width: 100%; height: 6px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden;">
                        <div style="width: 65%; height: 100%; background: linear-gradient(90deg, #8B0000, #5c0000);"></div>
                    </div>
                    <div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.5rem;">65% of budget used</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity Feed -->
    <div class="content-card">
        <div class="card-header">
            <h2><i class="fas fa-bell"></i> Recent Activity</h2>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <div style="width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite;"></div>
                <span style="color: #10b981; font-size: 0.9rem; font-weight: 600;">LIVE</span>
            </div>
        </div>
        <div class="card-content">
            <div style="max-height: 400px; overflow-y: auto;">
                <div style="display: grid; gap: 1rem;">
                    <!-- Activity Item 1 -->
                    <div style="display: flex; gap: 1rem; padding: 1rem; background: rgba(16, 185, 129, 0.05); border-left: 3px solid #10b981; border-radius: 8px;">
                        <div style="flex-shrink: 0;">
                            <div style="width: 40px; height: 40px; background: rgba(16, 185, 129, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-eye" style="color: #10b981;"></i>
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <div style="color: white; font-weight: 600; margin-bottom: 0.25rem; font-family: 'Merriweather', Georgia, serif;">New Views Milestone</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; font-family: 'Merriweather', Georgia, serif;">Summer Sale Campaign reached 45,000 views</div>
                            <div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.25rem;">2 minutes ago</div>
                        </div>
                    </div>

                    <!-- Activity Item 2 -->
                    <div style="display: flex; gap: 1rem; padding: 1rem; background: rgba(139, 0, 0, 0.05); border-left: 3px solid #8B0000; border-radius: 8px;">
                        <div style="flex-shrink: 0;">
                            <div style="width: 40px; height: 40px; background: rgba(139, 0, 0, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-rocket" style="color: #8B0000;"></i>
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <div style="color: white; font-weight: 600; margin-bottom: 0.25rem; font-family: 'Merriweather', Georgia, serif;">Campaign Launched</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; font-family: 'Merriweather', Georgia, serif;">Holiday Special campaign is now live</div>
                            <div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.25rem;">15 minutes ago</div>
                        </div>
                    </div>

                    <!-- Activity Item 3 -->
                    <div style="display: flex; gap: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.05); border-left: 3px solid #3b82f6; border-radius: 8px;">
                        <div style="flex-shrink: 0;">
                            <div style="width: 40px; height: 40px; background: rgba(59, 130, 246, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-chart-line" style="color: #3b82f6;"></i>
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <div style="color: white; font-weight: 600; margin-bottom: 0.25rem; font-family: 'Merriweather', Georgia, serif;">High Engagement Detected</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; font-family: 'Merriweather', Georgia, serif;">Product Launch showing 85% engagement rate</div>
                            <div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.25rem;">1 hour ago</div>
                        </div>
                    </div>

                    <!-- Activity Item 4 -->
                    <div style="display: flex; gap: 1rem; padding: 1rem; background: rgba(251, 191, 36, 0.05); border-left: 3px solid #fbbf24; border-radius: 8px;">
                        <div style="flex-shrink: 0;">
                            <div style="width: 40px; height: 40px; background: rgba(251, 191, 36, 0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-exclamation-triangle" style="color: #fbbf24;"></i>
                            </div>
                        </div>
                        <div style="flex: 1;">
                            <div style="color: white; font-weight: 600; margin-bottom: 0.25rem; font-family: 'Merriweather', Georgia, serif;">Budget Alert</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem; font-family: 'Merriweather', Georgia, serif;">Brand Awareness campaign at 90% budget usage</div>
                            <div style="color: var(--text-secondary); font-size: 0.8rem; margin-top: 0.25rem;">3 hours ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Campaign Details Modal with Real-Time Stats -->
<div id="campaign-details-modal" class="modal">
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h2><i class="fas fa-chart-line"></i> <span id="modal-campaign-name">Campaign Real-Time Dashboard</span></h2>
            <span class="close" onclick="closeCampaignDetails()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Campaign Overview Stats -->
            <div class="stats-grid" style="margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="detail-budget">$0</h3>
                        <p>Total Budget</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="detail-spent">$0</h3>
                        <p>Amount Spent</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="detail-views">0</h3>
                        <p>Total Views</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="detail-reach">0</h3>
                        <p>Total Reach</p>
                    </div>
                </div>
            </div>

            <!-- Real-Time Activity -->
            <div class="content-card" style="margin-bottom: 2rem;">
                <div class="card-header">
                    <h2><i class="fas fa-broadcast-tower"></i> Live Activity</h2>
                    <span class="live-indicator">
                        <span class="pulse"></span> LIVE
                    </span>
                </div>
                <div class="card-content">
                    <div id="live-activity-feed" class="activity-feed">
                        <div class="activity-item">
                            <i class="fas fa-eye"></i>
                            <span>Waiting for real-time data...</span>
                            <span class="activity-time">Just now</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Charts -->
            <div class="charts-container">
                <div class="content-card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h2>Views Over Time</h2>
                    </div>
                    <div class="card-content">
                        <canvas id="campaign-views-chart"></canvas>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h2>Engagement Metrics</h2>
                    </div>
                    <div class="card-content">
                        <canvas id="campaign-engagement-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Campaign Info -->
            <div class="content-card">
                <div class="card-header">
                    <h2>Campaign Details</h2>
                </div>
                <div class="card-content">
                    <div class="campaign-info-grid">
                        <div class="info-item">
                            <span class="info-label">Status:</span>
                            <span id="detail-status" class="campaign-status status-active">Active</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Duration:</span>
                            <span id="detail-duration">30 days</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Targeting:</span>
                            <span id="detail-targeting">General</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Created:</span>
                            <span id="detail-created">-</span>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <p class="info-label">Description:</p>
                        <p id="detail-description" style="color: var(--text-secondary); margin-top: 0.5rem;">-</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Campaign Modal -->
<div id="create-campaign-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Create New Campaign</h2>
            <span class="close" onclick="closeCreateCampaignModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="create-campaign-form">
                <div class="form-group">
                    <label for="campaign-name">Campaign Name</label>
                    <input type="text" id="campaign-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="campaign-description">Description</label>
                    <textarea id="campaign-description" name="description" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="campaign-budget">Budget ($)</label>
                        <input type="number" id="campaign-budget" name="budget" min="10" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="campaign-duration">Duration (days)</label>
                        <input type="number" id="campaign-duration" name="duration" min="1" max="365" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="campaign-video">Video URL</label>
                    <input type="url" id="campaign-video" name="video_url" required>
                </div>
                <div class="form-group">
                    <label for="campaign-targeting">Targeting</label>
                    <select id="campaign-targeting" name="targeting">
                        <option value="general">General</option>
                        <option value="age_18_25">Age 18-25</option>
                        <option value="age_26_35">Age 26-35</option>
                        <option value="age_36_45">Age 36-45</option>
                        <option value="tech_interested">Tech Interested</option>
                        <option value="crypto_interested">Crypto Interested</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeCreateCampaignModal()">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="createCampaign()">Create Campaign</button>
        </div>
    </div>
</div>

<script>
// Campaign Management JavaScript
let campaigns = [];

// Analytics charts
let performanceChart = null;
let distributionChart = null;

// Load campaigns on page load
document.addEventListener('DOMContentLoaded', function() {
    loadCampaigns();
    loadCampaignStats();
    initializeAnalyticsCharts();
});

async function loadCampaigns() {
    try {
        const response = await fetch('/api/campaigns', {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            campaigns = data.campaigns || [];
            displayCampaigns(campaigns);
        } else {
            console.error('Failed to load campaigns');
            displayMockCampaigns();
        }
    } catch (error) {
        console.error('Error loading campaigns:', error);
        displayMockCampaigns();
    }
}

function displayMockCampaigns() {
    campaigns = [
        {
            id: 1,
            name: "Tech Product Launch",
            description: "Promoting new tech product to tech-savvy audience",
            status: "active",
            budget: 1000,
            spent: 250,
            views: 15000,
            reach: 37500,
            impressions: 22500,
            duration: 30,
            created_at: "2024-01-15"
        },
        {
            id: 2,
            name: "Crypto Education",
            description: "Educational content about cryptocurrency",
            status: "active",
            budget: 500,
            spent: 180,
            views: 8500,
            reach: 21250,
            impressions: 12750,
            duration: 14,
            created_at: "2024-01-10"
        }
    ];
    displayCampaigns(campaigns);
    updateAnalyticsTable();
}

function displayCampaigns(campaignsToShow) {
    const container = document.getElementById('campaigns-list');
    
    if (campaignsToShow.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-bullhorn"></i>
                <h3>No campaigns found</h3>
                <p>Create your first campaign to get started</p>
                <button class="btn btn-primary" onclick="showCreateCampaignModal()">
                    <i class="fas fa-plus"></i> Create Campaign
                </button>
            </div>
        `;
        return;
    }
    
    updateAnalyticsTable();

    container.innerHTML = campaignsToShow.map(campaign => `
        <div class="campaign-card">
            <div class="campaign-header">
                <h3>${campaign.name || 'Untitled Campaign'}</h3>
                <span class="campaign-status status-${campaign.status || 'active'}">${campaign.status || 'active'}</span>
            </div>
            <div class="campaign-content">
                <p>${campaign.description || 'No description provided'}</p>
                <div class="campaign-stats">
                    <div class="stat">
                        <span class="label">Budget:</span>
                        <span class="value">$${campaign.budget || 0}</span>
                    </div>
                    <div class="stat">
                        <span class="label">Spent:</span>
                        <span class="value">$${campaign.spent || 0}</span>
                    </div>
                    <div class="stat">
                        <span class="label">Views:</span>
                        <span class="value">${(campaign.views || 0).toLocaleString()}</span>
                    </div>
                    <div class="stat">
                        <span class="label">Reach:</span>
                        <span class="value">${((campaign.views || 0) * 2.5).toLocaleString()}</span>
                    </div>
                </div>
            </div>
            <div class="campaign-actions">
                <button class="btn btn-sm btn-primary" onclick="viewCampaignDetails(${campaign.id})">
                    <i class="fas fa-chart-line"></i> View Real-Time Stats
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteCampaign(${campaign.id})">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    `).join('');
}

function filterCampaigns() {
    const filter = document.getElementById('campaign-filter').value;
    let filteredCampaigns = campaigns;
    
    if (filter !== 'all') {
        filteredCampaigns = campaigns.filter(campaign => campaign.status === filter);
    }
    
    displayCampaigns(filteredCampaigns);
}

// Initialize Analytics Charts
function initializeAnalyticsCharts() {
    // Performance Over Time Chart
    const perfCtx = document.getElementById('performance-chart').getContext('2d');
    performanceChart = new Chart(perfCtx, {
        type: 'line',
        data: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
            datasets: [
                {
                    label: 'Views',
                    data: [5000, 12000, 18000, 23500],
                    borderColor: '#8B0000',
                    backgroundColor: 'rgba(139, 0, 0, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Impressions',
                    data: [7500, 18000, 27000, 35250],
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    tension: 0.4,
                    fill: true
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    labels: { color: '#cbd5e1' }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#cbd5e1' },
                    grid: { color: 'rgba(139, 0, 0, 0.1)' }
                },
                x: {
                    ticks: { color: '#cbd5e1' },
                    grid: { color: 'rgba(139, 0, 0, 0.1)' }
                }
            }
        }
    });

    // Campaign Distribution Chart
    const distCtx = document.getElementById('distribution-chart').getContext('2d');
    distributionChart = new Chart(distCtx, {
        type: 'doughnut',
        data: {
            labels: ['Active', 'Paused', 'Completed'],
            datasets: [{
                data: [2, 0, 0],
                backgroundColor: [
                    '#10b981',
                    '#f59e0b',
                    '#6366f1'
                ],
                borderColor: '#1a1a2e',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { color: '#cbd5e1', padding: 15 }
                }
            }
        }
    });
}

// Update Analytics Table
function updateAnalyticsTable() {
    const tbody = document.getElementById('analytics-table-body');
    
    tbody.innerHTML = campaigns.map(campaign => {
        const roi = campaign.spent > 0 ? (((campaign.views * 0.01) - campaign.spent) / campaign.spent * 100).toFixed(1) : 0;
        const statusColors = {
            'active': '#10b981',
            'paused': '#f59e0b',
            'completed': '#6366f1'
        };
        
        return `
            <tr style="border-bottom: 1px solid rgba(139, 0, 0, 0.1);">
                <td style="padding: 1rem;">${campaign.name}</td>
                <td style="padding: 1rem; text-align: center;">${(campaign.views || 0).toLocaleString()}</td>
                <td style="padding: 1rem; text-align: center;">${(campaign.impressions || 0).toLocaleString()}</td>
                <td style="padding: 1rem; text-align: center;">${(campaign.reach || 0).toLocaleString()}</td>
                <td style="padding: 1rem; text-align: center;">$${campaign.budget}</td>
                <td style="padding: 1rem; text-align: center;">$${campaign.spent || 0}</td>
                <td style="padding: 1rem; text-align: center; color: ${roi >= 0 ? '#10b981' : '#ef4444'};">${roi}%</td>
                <td style="padding: 1rem; text-align: center;">
                    <span style="background: ${statusColors[campaign.status] || '#6366f1'}; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem;">
                        ${campaign.status}
                    </span>
                </td>
            </tr>
        `;
    }).join('');
}

async function loadCampaignStats() {
    try {
        const response = await fetch('/api/analytics', {
            headers: {
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            updateStats(data);
        } else {
            updateMockStats();
        }
    } catch (error) {
        console.error('Error loading stats:', error);
        updateMockStats();
    }
}

function updateMockStats() {
    document.getElementById('active-campaigns').textContent = '2';
    document.getElementById('total-views').textContent = '23,500';
    document.getElementById('total-spent').textContent = '$430';
    document.getElementById('avg-reach').textContent = '58,750';
}

function updateStats(data) {
    document.getElementById('active-campaigns').textContent = data.active_campaigns || 0;
    document.getElementById('total-views').textContent = (data.total_views || 0).toLocaleString();
    document.getElementById('total-spent').textContent = `$${data.total_spent || 0}`;
    document.getElementById('avg-reach').textContent = (data.avg_reach || 0).toLocaleString();
}

function showCreateCampaignModal() {
    document.getElementById('create-campaign-modal').style.display = 'block';
}

function closeCreateCampaignModal() {
    document.getElementById('create-campaign-modal').style.display = 'none';
    document.getElementById('create-campaign-form').reset();
}

async function createCampaign() {
    const form = document.getElementById('create-campaign-form');
    const formData = new FormData(form);
    
    const campaignData = {
        name: formData.get('name'),
        description: formData.get('description'),
        budget: parseFloat(formData.get('budget')),
        duration: parseInt(formData.get('duration')),
        video_url: formData.get('video_url'),
        targeting: formData.get('targeting')
    };
    
    try {
        const response = await fetch('/api/campaigns', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify(campaignData)
        });
        
        if (response.ok) {
            closeCreateCampaignModal();
            loadCampaigns();
            loadCampaignStats();
        } else {
            alert('Failed to create campaign');
        }
    } catch (error) {
        console.error('Error creating campaign:', error);
        alert('Error creating campaign');
    }
}

function refreshCampaigns() {
    loadCampaigns();
    loadCampaignStats();
}

let currentCampaignId = null;
let liveUpdateInterval = null;
let viewsChart = null;
let engagementChart = null;

function viewCampaignDetails(id) {
    currentCampaignId = id;
    const campaign = campaigns.find(c => c.id === id);
    
    if (!campaign) return;
    
    // Update modal content
    document.getElementById('modal-campaign-name').textContent = campaign.name;
    document.getElementById('detail-budget').textContent = `$${campaign.budget}`;
    document.getElementById('detail-spent').textContent = `$${campaign.spent || 0}`;
    document.getElementById('detail-views').textContent = (campaign.views || 0).toLocaleString();
    document.getElementById('detail-reach').textContent = ((campaign.views || 0) * 2.5).toLocaleString();
    document.getElementById('detail-status').textContent = campaign.status;
    document.getElementById('detail-status').className = `campaign-status status-${campaign.status}`;
    document.getElementById('detail-duration').textContent = `${campaign.duration || 30} days`;
    document.getElementById('detail-targeting').textContent = campaign.targeting || 'General';
    document.getElementById('detail-created').textContent = new Date(campaign.created_at).toLocaleDateString();
    document.getElementById('detail-description').textContent = campaign.description;
    
    // Show modal
    document.getElementById('campaign-details-modal').style.display = 'block';
    
    // Initialize charts
    setTimeout(() => {
        initializeCampaignCharts(campaign);
        startLiveUpdates(id);
    }, 100);
}

function closeCampaignDetails() {
    document.getElementById('campaign-details-modal').style.display = 'none';
    stopLiveUpdates();
    currentCampaignId = null;
}

function initializeCampaignCharts(campaign) {
    // Destroy existing charts
    if (viewsChart) viewsChart.destroy();
    if (engagementChart) engagementChart.destroy();
    
    // Views Over Time Chart
    const viewsCtx = document.getElementById('campaign-views-chart').getContext('2d');
    viewsChart = new Chart(viewsCtx, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Views',
                data: generateMockViewsData(campaign.views || 0),
                borderColor: '#ff4500',
                backgroundColor: 'rgba(139, 0, 0, 0.1)',
                tension: 0.4,
                fill: true,
                pointBackgroundColor: '#ff4500',
                pointBorderColor: '#fff',
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    labels: {
                        color: '#cbd5e1'
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        color: '#cbd5e1'
                    },
                    grid: {
                        color: 'rgba(139, 0, 0, 0.1)'
                    }
                },
                x: {
                    ticks: {
                        color: '#cbd5e1'
                    },
                    grid: {
                        color: 'rgba(139, 0, 0, 0.1)'
                    }
                }
            }
        }
    });
    
    // Engagement Metrics Chart
    const engagementCtx = document.getElementById('campaign-engagement-chart').getContext('2d');
    engagementChart = new Chart(engagementCtx, {
        type: 'doughnut',
        data: {
            labels: ['Views', 'Impressions', 'Reach', 'Conversions'],
            datasets: [{
                data: [
                    campaign.views || 0,
                    campaign.impressions || Math.floor((campaign.views || 0) * 1.5),
                    campaign.reach || Math.floor((campaign.views || 0) * 2.5),
                    Math.floor((campaign.views || 0) * 0.02)
                ],
                backgroundColor: [
                    '#8B0000',
                    '#A52A2A',
                    '#CD5C5C',
                    '#DC143C'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#cbd5e1',
                        padding: 15
                    }
                }
            }
        }
    });
}

function generateMockViewsData(totalViews) {
    const days = 7;
    const data = [];
    let remaining = totalViews;
    
    for (let i = 0; i < days - 1; i++) {
        const value = Math.floor(Math.random() * (remaining / (days - i)));
        data.push(value);
        remaining -= value;
    }
    data.push(remaining);
    
    return data;
}

function startLiveUpdates(campaignId) {
    // Simulate live activity updates
    liveUpdateInterval = setInterval(() => {
        addLiveActivity();
    }, 5000); // Update every 5 seconds
}

function stopLiveUpdates() {
    if (liveUpdateInterval) {
        clearInterval(liveUpdateInterval);
        liveUpdateInterval = null;
    }
}

function addLiveActivity() {
    const activities = [
        { icon: 'fa-eye', text: 'New view from San Francisco, CA', time: 'Just now' },
        { icon: 'fa-tv', text: 'Ad displayed in New York, NY', time: 'Just now' },
        { icon: 'fa-share', text: 'Ad shared in Los Angeles, CA', time: 'Just now' },
        { icon: 'fa-shopping-cart', text: 'Conversion tracked in Chicago, IL', time: 'Just now' },
        { icon: 'fa-users', text: 'Reached 1000+ people in Miami, FL', time: 'Just now' }
    ];
    
    const activity = activities[Math.floor(Math.random() * activities.length)];
    const feed = document.getElementById('live-activity-feed');
    
    const activityItem = document.createElement('div');
    activityItem.className = 'activity-item';
    activityItem.innerHTML = `
        <i class="fas ${activity.icon}"></i>
        <span>${activity.text}</span>
        <span class="activity-time">${activity.time}</span>
    `;
    
    feed.insertBefore(activityItem, feed.firstChild);
    
    // Keep only last 10 activities
    while (feed.children.length > 10) {
        feed.removeChild(feed.lastChild);
    }
}

function deleteCampaign(id) {
    if (confirm('Are you sure you want to delete this campaign?')) {
        // Implement delete functionality
        console.log('Delete campaign:', id);
    }
}

// Close modal when clicking outside
window.onclick = function(event) {
    const createModal = document.getElementById('create-campaign-modal');
    const detailsModal = document.getElementById('campaign-details-modal');
    
    if (event.target === createModal) {
        closeCreateCampaignModal();
    }
    
    if (event.target === detailsModal) {
        closeCampaignDetails();
    }
}
</script>
{% endblock %}


